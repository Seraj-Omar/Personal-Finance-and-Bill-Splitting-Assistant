"use client";

import { Box, Typography, Avatar } from "@mui/material";
import SuggestedBudgetChart from "./SuggestedBudgetChart";
import { ChatMessage } from "@/src/modules/askAIChat/type/type";


export default function ChatBubble({ msg }: { msg: ChatMessage }) {
  const isUser = msg.role === "user";
if (msg.type === "budgetCard" && msg.budget?.segments && msg.budget?.items) {
  const chartItems = msg.budget.segments.map((s, i) => ({
    category: s.label,
    percentage: s.value,
    amount: Number(msg.budget!.items[i]?.amount ?? 0),
  }));

  return (
    <Box
      sx={{
        display: "flex",
        justifyContent: "flex-start",
        gap: 1,
        alignItems: "flex-start",
      }}
    >
      <Avatar sx={{ width: 28, height: 28 }}>
        <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M17.2014 3.2508C18.4812 3.54101 19.7055 4.04494 20.8188 4.73967L22.5835 1.91179C21.1538 1.01959 19.5821 0.372706 17.9386 0L17.2014 3.2508Z" fill="#3447AA"/>
          <path d="M10.1433 3.86359C10.76 3.60652 11.385 3.40666 12.0126 3.26116L11.2599 0.0139356C10.452 0.201225 9.64971 0.457999 8.86078 0.786863C8.07185 1.11573 7.32475 1.50479 6.62299 1.94681L8.39955 4.76727C8.9447 4.42388 9.5266 4.12066 10.1433 3.86359Z" fill="#3447AA"/>
          <path d="M24.497 8.39955C24.8404 8.9447 25.1436 9.5266 25.4007 10.1433C25.6577 10.76 25.8576 11.385 26.0031 12.0126L29.2503 11.2599C29.063 10.452 28.8063 9.64971 28.4774 8.86078C28.1485 8.07185 27.7595 7.32475 27.3175 6.62299L24.497 8.39955Z" fill="#3447AA"/>
          <path d="M3.2508 12.0629C3.54101 10.7831 4.04494 9.55872 4.73967 8.44543L1.91179 6.68072C1.01959 8.11044 0.372706 9.68213 0 11.3257L3.2508 12.0629Z" fill="#3447AA"/>
          <path d="M26.0135 17.2014C25.7233 18.4812 25.2193 19.7055 24.5246 20.8188L27.3525 22.5835C28.2447 21.1538 28.8916 19.5821 29.2643 17.9386L26.0135 17.2014Z" fill="#3447AA"/>
          <path d="M3.86359 19.121C3.60652 18.5043 3.40666 17.8793 3.26116 17.2516L0.0139358 18.0044C0.201225 18.8123 0.457999 19.6146 0.786863 20.4035C1.11573 21.1924 1.50479 21.9395 1.94681 22.6413L4.76727 20.8647C4.42388 20.3196 4.12066 19.7377 3.86359 19.121Z" fill="#3447AA"/>
          <path d="M20.8647 24.497C20.3196 24.8404 19.7377 25.1436 19.121 25.4007C18.5043 25.6577 17.8793 25.8576 17.2516 26.0031L18.0044 29.2503C18.8123 29.063 19.6146 28.8063 20.4035 28.4774C21.1924 28.1485 21.9395 27.7595 22.6413 27.3175L20.8647 24.497Z" fill="#3447AA"/>
          <path d="M12.0629 26.0135C10.7831 25.7233 9.55872 25.2193 8.44543 24.5246L6.68072 27.3525C8.11044 28.2447 9.68213 28.8916 11.3257 29.2643L12.0629 26.0135Z" fill="#3447AA"/>
          <path fillRule="evenodd" clipRule="evenodd" d="M13.051 4.10508L10.8145 10.8145L4.1051 13.051V16.2133L10.8145 18.4497L13.051 25.1592H16.2133L18.4498 18.4497L25.1592 16.2133V13.051L18.4498 10.8145L16.2133 4.10508H13.051ZM13.7133 12.6592L14.6321 9.90259L15.551 12.6592L16.6051 13.7133L19.3617 14.6321L16.6051 15.551L15.551 16.6051L14.6321 19.3617L13.7133 16.6051L12.6592 15.551L9.90261 14.6321L12.6592 13.7133L13.7133 12.6592Z" fill="#3447AA"/>
        </svg>
      </Avatar>

      <Box
        sx={{
          maxWidth: "70%",
          borderRadius: 3,
          backgroundColor: "#F4F6F8",
          p: 1,
        }}
      >
        <SuggestedBudgetChart items={chartItems} />
      </Box>
    </Box>
  );
}

  return (
    <Box
      sx={{
        display: "flex",
        justifyContent: isUser ? "flex-end" : "flex-start",
        gap: 1,
      }}
    >
      {!isUser && <Avatar sx={{ width: 28, height: 28 }}><svg width="30" height="30" viewBox="0 0 30 30" xmlns="http://www.w3.org/2000/svg">
<path d="M17.2014 3.2508C18.4812 3.54101 19.7055 4.04494 20.8188 4.73967L22.5835 1.91179C21.1538 1.01959 19.5821 0.372706 17.9386 0L17.2014 3.2508Z" fill="#3447AA"/>
<path d="M10.1433 3.86359C10.76 3.60652 11.385 3.40666 12.0126 3.26116L11.2599 0.0139356C10.452 0.201225 9.64971 0.457999 8.86078 0.786863C8.07185 1.11573 7.32475 1.50479 6.62299 1.94681L8.39955 4.76727C8.9447 4.42388 9.5266 4.12066 10.1433 3.86359Z" fill="#3447AA"/>
<path d="M24.497 8.39955C24.8404 8.9447 25.1436 9.5266 25.4007 10.1433C25.6577 10.76 25.8576 11.385 26.0031 12.0126L29.2503 11.2599C29.063 10.452 28.8063 9.64971 28.4774 8.86078C28.1485 8.07185 27.7595 7.32475 27.3175 6.62299L24.497 8.39955Z" fill="#3447AA"/>
<path d="M3.2508 12.0629C3.54101 10.7831 4.04494 9.55872 4.73967 8.44543L1.91179 6.68072C1.01959 8.11044 0.372706 9.68213 0 11.3257L3.2508 12.0629Z" fill="#3447AA"/>
<path d="M26.0135 17.2014C25.7233 18.4812 25.2193 19.7055 24.5246 20.8188L27.3525 22.5835C28.2447 21.1538 28.8916 19.5821 29.2643 17.9386L26.0135 17.2014Z" fill="#3447AA"/>
<path d="M3.86359 19.121C3.60652 18.5043 3.40666 17.8793 3.26116 17.2516L0.0139358 18.0044C0.201225 18.8123 0.457999 19.6146 0.786863 20.4035C1.11573 21.1924 1.50479 21.9395 1.94681 22.6413L4.76727 20.8647C4.42388 20.3196 4.12066 19.7377 3.86359 19.121Z" fill="#3447AA"/>
<path d="M20.8647 24.497C20.3196 24.8404 19.7377 25.1436 19.121 25.4007C18.5043 25.6577 17.8793 25.8576 17.2516 26.0031L18.0044 29.2503C18.8123 29.063 19.6146 28.8063 20.4035 28.4774C21.1924 28.1485 21.9395 27.7595 22.6413 27.3175L20.8647 24.497Z" fill="#3447AA"/>
<path d="M12.0629 26.0135C10.7831 25.7233 9.55872 25.2193 8.44543 24.5246L6.68072 27.3525C8.11044 28.2447 9.68213 28.8916 11.3257 29.2643L12.0629 26.0135Z" fill="#3447AA"/>
<path fillRule="evenodd" clipRule="evenodd" d="M13.051 4.10508L10.8145 10.8145L4.1051 13.051V16.2133L10.8145 18.4497L13.051 25.1592H16.2133L18.4498 18.4497L25.1592 16.2133V13.051L18.4498 10.8145L16.2133 4.10508H13.051ZM13.7133 12.6592L14.6321 9.90259L15.551 12.6592L16.6051 13.7133L19.3617 14.6321L16.6051 15.551L15.551 16.6051L14.6321 19.3617L13.7133 16.6051L12.6592 15.551L9.90261 14.6321L12.6592 13.7133L13.7133 12.6592Z" fill="#3447AA"/>
</svg>
</Avatar>}

      <Box
        sx={{
          maxWidth: "70%",
          px: 2,
          py: 1.2,
          borderRadius: 3,
          backgroundColor: isUser ? "#EEF2FF" : "#F4F6F8",
        }}
      >
        <Typography variant="body2" sx={{ whiteSpace: "pre-wrap" }}>
          {msg.content}
        </Typography>
      </Box>

      {isUser && <Avatar sx={{ width: 28, height: 28  ,   bgcolor: "rgba(52, 71, 170, 0.15)", }}><svg width="19" height="23" viewBox="0 0 19 23" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M0.679104 17.043C5.0306 12.4981 13.0284 12.2508 17.474 17.0508L17.7787 17.3555C18.0209 17.5976 18.1536 17.9282 18.1449 18.2705C18.1364 18.6127 17.9876 18.9364 17.7338 19.166C15.4436 21.2368 12.404 22.5 9.07266 22.5C5.74139 22.5 2.70164 21.2368 0.411526 19.166C0.157812 18.9364 0.00898847 18.6127 0.000393152 18.2705C-0.00820383 17.9282 0.124552 17.5976 0.366604 17.3555L0.679104 17.043ZM9.05606 0C12.0491 0.000171614 14.4779 2.42388 14.4779 5.41699C14.4778 8.4099 12.049 10.8328 9.05606 10.833C6.06317 10.833 3.63338 8.41001 3.63321 5.41699C3.63321 2.42378 6.06306 0 9.05606 0Z" fill="#3447AA"/>
</svg>
</Avatar>}
    </Box>
  );
}
